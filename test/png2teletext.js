const rewire = require('rewire');
const img2teletext = rewire('../src/index');
const assert = require('assert');
const fs = require('fs');
const PNG = require('pngjs').PNG;

const test1 = new Uint8Array([
	0x20,
	0x30,
	0x60,
	0x70,
	0x21,
	0x31,
	0x61,
	0x71,
	0x22,
	0x32,
	0x62,
	0x72,
	0x23,
	0x33,
	0x63,
	0x73,
	0x24,
	0x34,
	0x64,
	0x74,
	0x25,
	0x35,
	0x65,
	0x75,
	0x26,
	0x36,
	0x66,
	0x76,
	0x27,
	0x37,
	0x67,
	0x77,
	0x28,
	0x38,
	0x68,
	0x78,
	0x29,
	0x39,
	0x69,
	0x79,
	0x2a,
	0x3a,
	0x6a,
	0x7a,
	0x2b,
	0x3b,
	0x6b,
	0x7b,
	0x2c,
	0x3c,
	0x6c,
	0x7c,
	0x2d,
	0x3d,
	0x6d,
	0x7d,
	0x2e,
	0x3e,
	0x6e,
	0x7e,
	0x2f,
	0x3f,
	0x6f,
	0x7f,
]);

describe('img2teletext', function() {
	it('should return with the correct teletext data', function() {
		const data = fs.readFileSync('./test/test.png');
		const png = PNG.sync.read(data);
		const teletext = img2teletext(png.data, png.width);

		assert.deepStrictEqual(teletext, test1);
	});
});
